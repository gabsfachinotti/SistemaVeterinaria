@model IEnumerable<SistemaVeterinaria.Models.Surgery>

@{
    ViewBag.Title = "Index";
}

<head>
    <style>
        #SurgeryTypesTable_wrapper{
            margin-top:0;
        }
    </style>
</head>
<div style="width: 100%;display: inline-flex">
    <div style="width: 25%"><a id="createSurgery" class="btn btn-success" style="margin-top: 6%">Agregar Cirugía</a></div>
    <div style="width: 50%">
        <h2 class="text-center">Notificaciones de Cirugías</h2>
    </div>
    <div class="text-right" style="width: 25%"><a id="openSurgeryTypes" class="btn btn-primary" style="margin-top: 6%">Cirugías</a></div>
</div>
<hr style="color: grey;border-color: grey;margin-top: 0"/>
<table id="table" class="table table-bordered">
    <thead>
        <tr>
            <th>
                Nro
            </th>
            <th>
                Paciente
            </th>
            <th class="text-center">
                Cirugía
            </th>
            <th class="text-center">
                Fecha
            </th>
            <th class="text-center">
                Opciones
            </th>
        </tr>
    </thead>

<tbody>
    @foreach (var item in Model)
    {
        <tr>
            <td>
                @item.SurgeryId
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Pet.PetName)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.SurgeryType.SurgeryTypeName)
            </td>
            <td>
                <text>@item.SurgeryDate.ToString("yyyy/MM/dd").Split('/')[0]@item.SurgeryDate.ToString("yyyy/MM/dd").Split('/')[1]@item.SurgeryDate.ToString("yyyy/MM/dd").Split('/')[2]</text>
                <text>@item.SurgeryDate.ToShortDateString()</text>
            </td>
            <td class="text-center">
                <button class="btn btn-primary btn-sm"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></button>
                <button class="btn btn-danger btn-sm"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></button>
            </td>
        </tr>
    }
</tbody>
</table>

<div id="modalSurgeryTypes" class="modal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="closeSurgeryTypes">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title text-center">Cirugías</h4>                
            </div>
            <div class="modal-body">
                <button id="addSurgeryType" class="btn btn-success btn-sm"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button>
                <table id="SurgeryTypesTable" class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Nro</th>
                            <th>Cirugía</th>
                            <th class="text-center">Opciones</th>
                        </tr>
                    </thead>
                    <tbody id="SurgeryTypes">
                        @foreach (var item in ViewBag.SurgeryTypes)
                        {
                            <tr>
                                <td>@item.SurgeryTypeId</td>
                                <td>@item.SurgeryTypeName</td>
                                <td class="text-center">
                                    <button class="btn btn-success btn-sm"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></button>
                                    <button class="btn btn-danger btn-sm"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
                <input id="currentId" type="number" style="display:none" value="@ViewBag.LastSurgeryTypeId" />
            </div>
            <div class="modal-footer">
                <button id="Cancel" type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

@section scripts{
    <script>
        $('#table').DataTable({
            order: [[3, "asc"]],
            "language": {
                "url": "/Scripts/DataTables/spanish.json"
            }
        });

        $('#SurgeryTypesTable').DataTable({
            "bInfo": false,
            "bLengthChange": false,
            "lengthMenu": [[5], [5]],
            "language": {
                "url": "/Scripts/DataTables/spanish.json"
            }
        });

        $('#openSurgeryTypes').click(function () {
            $('#modalSurgeryTypes').show('slow');
        });

        $('#Cancel').click(function () {
            $('#modalSurgeryTypes').hide('slow');
        });

        $('#addSurgeryType').click(function () {
            var futureId = parseInt($('#currentId').val()) + 1;
            var row = '<tr>';
            row += '<td id="SurgeryTypeId' + futureId + '">' + String(futureId) + '</td>';
            row += '<td id="SurgeryTypeName' + futureId + '"><input id="SurgeryTypeName' + futureId + '" type="text" /></td>';
            //row += '<td id="SurgeryTypeButtons' + futureId +'" class="text-center"><button class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></button>&nbsp;<button class="btn btn-danger btn-xs"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></button></td>';
            row += '<td class="text-center"><button class="btn btn-success btn-xs"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></button>&nbsp;<button class="btn btn-danger btn-xs"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button></td>';
            row += '</tr>'

            if (futureId == 1) {
                $('#SurgeryTypes').html(row);
            } else {
                $('#SurgeryTypes').prepend(row);
            }            
        });
    </script>
}
